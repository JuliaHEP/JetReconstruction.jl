# Compiling JetReconstruction.jl to a C-library

Minimal C bindings for JetReconstruction.jl

- [C-header](JetReconstruction.h)
- shared library compiled with [PackageCompiler.jl](https://github.com/JuliaLang/PackageCompiler.jl)

## Building library

To build the library, run the following command from the package root directory:

```sh
julia --project=compile compile/build.jl
```

## Usage example

### Example source file

Example usage of C bindings in an application:

```C
#include "JetReconstruction.h"
#include "julia_init.h" /*Should be automatically generated by PackageCompiler.jl and distributed together with the "JetReconstruction.h" header file*/

int main(int argc, char *argv[]) {
  init_julia(argc, argv); /*initialization of julia runtime*/

  /*Prepare array of pseudo jets*/
  size_t particles_len;
  jetreconstruction_PseudoJet* particles;
  /*Initialize with desired values*/

  /*Call jet reconstruction*/
  jetreconstruction_JetAlgorithm algorithm = JETRECONSTRUCTION_JETALGORITHM_CA;
  double R = 3.0;
  jetreconstruction_RecoStrategy strategy = JETRECONSTRUCTION_RECOSTRATEGY_BEST;

  jetreconstruction_ClusterSequence cluster_seq;
  jetreconstruction_jet_reconstruct(particles, len, algorithm, R, strategy,
                                    &cluster_seq);

  /*Use the cluster sequence  in your application
  then free memory allocations done by library*/
  jetreconstruction_ClusterSequence_free_members(&cluster_seq);
  shutdown_julia(0); /*teardown of julia runtime*/
  return 0;
}

```

### Example compilation

To build an example application run the following command:

```shell
cc -o jetreconstruction_test compile/test/jetreconstruction_test.c -IJetReconstructionCompiled/include -LJetReconstructionCompiled/lib -ljetreconstruction -ljulia
```

In case the compiled library resides in non-standard location, add its location to `LD_LIBRARY_PATH` when running example application:

```shell
LD_LIBRARY_PATH=JetReconstructionCompiled/lib/:${LD_LIBRARY_PATH} ./jetreconstruction_test
```

